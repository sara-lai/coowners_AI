<div class="container" style="padding-left:30px;">
  <div class="row">
    <div class="col-md-6">
      <div class="card shadow rounded overflow-hidden">
        <div class="card-img-top position-relative" style="height: 400px; background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('<%= @property.photo.attached? ? cl_image_path(@property.photo.key, height: 300, crop: :fill) : asset_path("default-placeholder.png") %>'); background-size:cover; background-position:center;">
          <div class="position-absolute bottom-0 start-0 p-3 text-white">
            <h4 class="mb-1 fw-bold" style='font-size:1.75rem;'><%= @property.name %></h4>
            <p class="mb-0 small"><%= @property.address %></p>
            <p class="mb-0 small">Jurisdiction: <%= @property.jurisdiction %></p>
          </div>
        </div>

        <div class="card-body">
          <p class="fw-medium mb-2" style='font-size:0.875rem; letter-spacing:0.5px; color:#757575;'>Documents</p>
          <% if @property.documents.attached? %>
            <div style='display:flex; flex-direction:column; gap:8px;'>
              <% @property.documents.each do |document| %>
                <div class="small">
                  <%= link_to document.filename.to_s, url_for(document), target: "_blank", class: "text-decoration-none text-primary" %>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="small text-muted">No documents uploaded yet.</p>
          <% end %>
        </div>

        <div class='card-footer bg-white border-top-0' style='display:flex; justify-content:flex-start; align-items:center; padding:16px;'>
          <button type="button" class="btn btn-sm btn-outline-primary rounded-pill px-3" data-bs-toggle="modal" data-bs-target="#addDocumentsModal">
            <i class="fas fa-edit me-1"></i> Add Documents
          </button>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div style='display:flex; justify-content:start; align-items:center; height:100%; margin-left:60px;'>
        <div style='padding:10px; padding-left:0px;'>

          <div style='font-size:1.8rem; margin-bottom:20px;'>
            <%= button_to property_chats_path(@property), class: "btn btn-primary" do %>
              <i class="fa-solid fa-wand-magic-sparkles me-1"></i> New AI Session
            <% end %>
          </div>

          <div class="mb-4">
            <% if @property.chats.any? %>
              <div style='display:flex; flex-direction:column; gap:12px;'>
                <% @chats.each do |chat| %>
                  <div class="card chat-item shadow-sm border-0" style="border-radius: 8px; transition: box-shadow 0.2s, background-color 0.2s;">
                    <div class="card-body p-3">

                      <div class="d-flex align-items-center">
                        <%= link_to chat.title, chat_path(chat), class: "text-decoration-none text-primary flex-grow-1 fw-medium" %>
                        <%= link_to chat_path(chat),
                            data: { turbo_method: :delete, confirm: "Are you sure you want to delete this chat?" },
                            class: "text-muted ms-auto delete-icon",
                            style: "display: none; opacity: 0.5;" do %>
                          <i class="fa-regular fa-trash-can"></i>
                        <% end %>
                      </div>

                      <p class="text-muted small mt-2 mb-0" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                        <%= truncate(chat.messages.order(created_at: :desc).first&.content || "No messages yet", length: 60) %>
                      </p>
                    </div>
                  </div>
                <% end %>
              </div>
            <% else %>
              There are no chats yet.
            <% end %>
          </div>
        </div>
      </div>
    </div>

  </div>


  <%= render "shared/add_documents_modal", property: @property %>


</div>
